<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Learning Angular</title>
    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <!--suppress JSUnresolvedLibraryURL -->
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.7/angular.min.js"></script>
  </head>


  <body>
    <h5 style="text-align:right;padding-right:8px;"><a href="https://docs.angularjs.org/api/" target="_blank">Learning AngularJS</a></h5>

    <!--
    /**
     * View in the sense of the MVC-pattern
     */
    -->
    <div data-ng-app="flug"> <!-- Bind onto module via directive -->
      <div data-ng-controller="FlugBuchenCtrl"> <!-- Bind onto controller via directive -->
        <div class="container">

          <h2>Flug ausw채hlen</h2>
          <div data-ng-show="vm.message" class="message">
            {{ vm.message }}
          </div>

          <div class="form-group">
            <label>Flugnummer</label>
            <input data-ng-model="vm.flugNummerFilter" class="form-control" title="" />
          </div>

          <div class="form-group">
            <label>Von</label>
            <input data-ng-model="vm.flugVonFilter" class="form-control" title="" />
          </div>

          <div class="form-group">
            <label>Nach</label>
            <input data-ng-model="vm.flugNachFilter" class="form-control" title="" />
          </div>

          <div class="form-group">
            <input type="button" value="Suchen" data-ng-click="vm.loadFluege()" class="btn" />
          </div>

          <div>
            <table data-ng-show="vm.fluege.length > 0" class="table table-striped">
              <tr>
                <th>Id</th>
                <th>Datum</th>
                <th>Abflugort</th>
                <th>Zielort</th>
                <th>Aktion</th>
              </tr>

              <tr data-ng-repeat="f in vm.fluege" data-ng-class="{ info: f.id === vm.selectedFlug.id }">
                <td>{{f.id}}</td>
                <td>{{f.datum | date:'shortDate'}}</td>
                <td>{{f.abflugort}}</td>
                <td>{{f.zielort}}</td>
                <td><a href="" data-ng-click="vm.slectFlug(f)">Ausw채hlen</a></td>
              </tr>
            </table>
          </div>

        </div>
      </div>
    </div>
    <!--
      Known directives + explanation
      ------------------------------
      ng-app        -> module
      ng-controller
      ng-show
      ng-hide
      ng-bind       -> 1-way-databinding
      ng-model      -> 2-way-databinding
      ng-click
      ng-change
      ng-blur
      ng-focus
      ng-checked
      ng-repeat
      ng-class      -> css-class (depending on condition)
    -->
  </body>

  <script>
    console.log('Starting angular-stuff...');

    // AngularJS strukturiert Anwendungen anhand von Modulen
    // Ein Modul kapselt wiederverwendbare Programmteile und Konfigurationsinformationen
    // Zu diesen Programmteilen z채hlen Controller im Sinne des MVC-Musters. Bei Controllern
    // handelt es sich unter AngularJS um Einheiten, welche Models (bzw. View-Models) bereitstellen
    // Eine View k체mmert sich in weiterer Folge um deren Visualsierung.
    // Bereitstellung eines Moduls mit einem Controller:
    var app = angular.module('flug', []); // 'Modulname', [] mit zu importierenden Modulen // 'ng' is imported by default

    /**
     * Controller in the sense of the MVC-pattern - will provide a model respectively a view-model
     */
    // AngularJS treats parameters as dependendencies and calls them "Services"
    // Second param of app.controller() is the controller-constructorfunction (will provide a model-object to bind it to the view)
    app.controller('FlugBuchenCtrl', function($scope, $http) { // "wellknown names" (AngularJS will inject the dependencies)
        // List of "Services" (= dependencies = wellknown Names)
        // 1) The $scope is the model of the MVC-pattern
        // 2) $http allows accessing http resources the easy way

// debugger;

      // a controller will provide the (view-)model via its scope
      $scope.vm = new FlugBuchenVM($http); // vm = view-model
      // dedicated view-model vs. self-created view-model
      // $scope.vm = {... loadFluege: function() { ... } ...}; //
    });


    /**
     * Model respectively view-model.
     */
    function Flug(id, abflugort, zielort, datum) {
      this.id = id;
      this.abflugort = abflugort;
      this.zielort = zielort;
      this.datum = datum;
    }

    function FlugBuchenVM($http) {
      var that = this;

      this.fluege = [];

      this.selectedFlug = null;

      this.message = "";
      this.flugNummerFilter = "";
      this.flugVonFilter = "";
      this.flugNachFilter = "";

      this.loadFluege = function() {
        alert('I called loadFluege()!');
        that.fluege.push(new Flug(1, "Graz", "Essen", new Date()));
        that.fluege.push(new Flug(2, "Graz", "Frankfurt", new Date()));
      };

      this.selectFlug = function(f) {
        this.selectedFlug = f;
      }
    }

    console.log('...finished it.');
  </script>
</html>
